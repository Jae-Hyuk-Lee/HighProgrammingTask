// 2023-2 �������α׷��� ����: �޲ٹ� ����
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <time.h>
#include "jjuggumi.h"

#define	DATA_FILE	"jjuggumi.dat"

int jjuggumi_init(void);

// low �̻� high ���� ������ �߻���Ű�� �Լ�
int randint(int low, int high) {
	int rnum = rand() % (high - low + 1) + low;
	return rnum;
}

int jjuggumi_init(void) {
	char msg[50];
    srand((unsigned int)time(NULL));
    FILE* fp;
    fopen_s(&fp, "jjuggumi.dat", "r");
    if (fp == NULL) {
        return -1; // -1 �����ϸ� �����Լ����� ó���ϰ� ����
    }

    // �÷��̾� ������ load
    fscanf_s(fp, "%d", &n_player);
    printf("%d", n_player);
    for (int i = 0; i < n_player; i++) {
        // ���� �� ��� ����(����ü ������, ��������������)
        PLAYER* p = &player[i];
        // ���Ͽ��� �� ���� �ִ� �б�
        fscanf_s(fp, "%s%d%d",
            p->name, (unsigned int)sizeof(p->name),
            &(p->intel), &(p->str));
        p->id = i;
        p->stamina = 100; // 100%
        // ���� ����
        p->is_alive = true;
        p->hasitem = false;
        p->is_dead = true;
    }

    // ������ ������ load
    fscanf_s(fp, "%d", &n_item);
    for (int i = 0; i < n_item; i++) {
        fscanf_s(fp, "%s%d%d%d",
            item[i].name, (unsigned int)sizeof(item[i].name),
            &(item[i].intel_buf),
            &(item[i].str_buf),
            &(item[i].stamina_buf));
    }
    fclose(fp);
    return 0;


}

void intro1() {
	system("cls");
	printf("===========================================================================\n");
	printf("=-------------------------------------------------------------------------=\n");
	printf("=---------------#-----##------------------------#-----##------------------=\n");
	printf("=-----##-----##-#-----##--#########--#########--#-----##-##------##-##----=\n");
	printf("=-----##-----##-#-----##-##---------##----------#-----##-###----###-##----=\n");
	printf("=-----##-----##-##----##-#------##--##-----##---##----##-####-##-##-##----=\n");
	printf("=-----##-----##--######---#########--#########---######--##-###--##-##----=\n");
	printf("=-#--##--#--##--------------------##---------##----------##---------------=\n");
	printf("=--###----###----------------------##---------##---------##---------------=\n");
	printf("=-------------------------------------------------------------------------=\n");
	printf("=---------------------------#########----##---###-----###-#########-------=\n");
	printf("=--------------------------##-----------####--####---####-##++++++--------=\n");
	printf("=--------------------------#---#####---##++##-#####-##-##-##++#########---=\n");
	printf("=---------------------------#########--#++++##-##-####-##-##++++++#-------=\n");
	printf("=-----------------------------------##--------###---------#########-------=\n");
	printf("=------------------------------------##--------##-------------------------=\n");
	printf("=-------------------------------------------------------------------------=\n");
	printf("===========================================================================\n");
	printf("\n");
	printf("===========================================================================\n\n");
	printf("                    �޲ٹ� ���ӿ� ���� ���� ȯ���մϴ�!\n\n");
	printf("===========================================================================\n");
	Sleep(1000);
}
void intro2() {
	system("cls");
	printf("===========================================================================\n");
	printf("=-------------------------------------------------------------------------=\n");
	printf("=---------------#-----##------------------------#-----##------------------=\n");
	printf("=-----##-----##-#-----##--#########--#########--#-----##-##------##-##----=\n");
	printf("=-----##-----##-#-----##-##---------##----------#-----##-###----###-##----=\n");
	printf("=-----##-----##-##----##-#------##--##-----##---##----##-####-##-##-##----=\n");
	printf("=-----##-----##--######---#########--#########---######--##-###--##-##----=\n");
	printf("=-#--##--#--##--------------------##---------##----------##---------------=\n");
	printf("=--###----###----------------------##---------##---------##---------------=\n");
	printf("=-------------------------------------------------------------------------=\n");
	printf("=---------------------------#########----##---###-----###-#########-------=\n");
	printf("=--------------------------##-----------####--####---####-##++++++--------=\n");
	printf("=--------------------------#---#####---##++##-#####-##-##-##++#########---=\n");
	printf("=---------------------------#########--#++++##-##-####-##-##++++++#-------=\n");
	printf("=-----------------------------------##--------###---------#########-------=\n");
	printf("=------------------------------------##--------##-------------------------=\n");
	printf("=-------------------------------------------------------------------------=\n");
	printf("===========================================================================\n");
	printf("\n");
	printf("===========================================================================\n\n");
	printf("                    �޲ٹ� ���ӿ� ���� ���� ȯ���մϴ�!\n");
	printf("                  �� %d���� �����ڷ� �޲ٹ� ������ �����մϴ�!\n\n", n_player);
	printf("===========================================================================\n");
	Sleep(2000);
}
void intro() {
	intro1();
	intro2();
}

void ending1() {
	system("cls");
	printf("=========================================================================\n\n");
	printf("                       �޲ٹ� ������ ����ڴ� �ٷ�\n\n");
	printf("=========================================================================\n");
	Sleep(1000);

}
void ending2() {
	int winner = -1;

	for (int i = 0; i < n_player; i++)
		if (player[i].is_alive)
			winner = player[i].id;
	system("cls");

	printf("=========================================================================\n\n");
	printf("                       �޲ٹ� ������ ����ڴ� �ٷ�\n");
	printf("                     %d�� �÷��̾��Դϴ�! ���ϵ帳�ϴ�!\n\n", winner);
	printf("=========================================================================\n");
	Sleep(2000);

}

// 73
void ending3() {
	system("cls");
	printf("=========================================================================\n\n");
	printf("���ѽð��� �� �Ǿ����ϴ�.\n�����ڴ� ");
	for (int i = 0; i < n_player; i++) {
		if (player[i].is_alive) {
			printf("%d�� ", i);
			Sleep(1000);
		}
	}
	printf("�Դϴ�.\n\n");
	printf("=========================================================================\n");
	Sleep(3000);
}


void ending4() {
    system("cls");
    printf("=========================================================================\n\n");
    printf("������ �������ϴ�.\n�����ڴ� ");
    for (int i = 0; i < n_player; i++) {
        if (player[i].is_dead) {
            player[i].is_alive = true;
            
            printf("%d�� ", i);
            Sleep(1000);
        }
    }
    printf("�Դϴ�.\n\n");
    printf("=========================================================================\n");
    Sleep(3000);
}

void ending() {
    int count = 0;
    
    for (int i = 0; i < n_player; i++)
    {
        if (player[i].is_alive == true)
        {
            count++;
        }
    }

	if (count == 1) {
		ending1();
		ending2();
	}
	else {
		ending3();
	}
}

int main(void) {
	jjuggumi_init();
	//sample();
	intro();
	mugunghwa();
	nightgame();
	juldarigi();
	jebi();
	ending();
	return 0;
}

